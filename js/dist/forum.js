(()=>{var t={n:e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},d:(e,o)=>{for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e);const o=flarum.core.compat["forum/app"];var n=t.n(o);const r=flarum.core.compat.extend,s=flarum.core.compat["forum/components/UserPage"];var a=t.n(s);const i=flarum.core.compat["components/UserCard"];var u=t.n(i);const l=flarum.core.compat["utils/UserControls"];var c=t.n(l);const y=flarum.core.compat["components/Button"];var p=t.n(y);function d(t,e){return d=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},d(t,e)}function h(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,d(t,e)}const f=flarum.core.compat["components/Modal"];var g=t.n(f);const v=flarum.core.compat["utils/Stream"];var b=t.n(v),M=function(t){function e(){return t.apply(this,arguments)||this}h(e,t);var o=e.prototype;return o.oninit=function(e){t.prototype.oninit.call(this,e),this.money=b()(this.attrs.user.data.attributes.money||0)},o.className=function(){return"UserMoneyModal Modal--small"},o.title=function(){return app.translator.trans("gtdxyz-money-plus.forum.modal.title",{user:this.attrs.user})},o.content=function(){var t=app.forum.attribute("gtdxyz-money-plus.moneyname")||"MO";return m("div",{className:"Modal-body"},m("div",{className:"Form"},m("div",{className:"Form-group"},m("label",null,app.translator.trans("gtdxyz-money-plus.forum.modal.current")," ",this.money(),t),m("input",{required:!0,className:"FormControl",type:"number",step:"any",bidi:this.money})),m("div",{className:"Form-group"},p().component({className:"Button Button--primary",type:"submit",loading:this.loading},app.translator.trans("gtdxyz-money-plus.forum.modal.submit_button")))))},o.onsubmit=function(t){var e=this;t.preventDefault(),this.loading=!0,this.attrs.user.save({money:this.money()},{errorHandler:this.onerror.bind(this)}).then(this.hide.bind(this)).catch((function(){e.loading=!1,m.redraw()}))},e}(g());const x=flarum.core.compat.Model;var N=t.n(x);const z=flarum.core.compat["models/User"];var _=t.n(z);const H=flarum.core.compat["common/components/LinkButton"];var O=t.n(H);const R=flarum.core.compat.Component;var U=t.n(R);const w=flarum.core.compat.app;var j=t.n(w);const k=flarum.core.compat["components/LoadingIndicator"];var P=t.n(k);flarum.core.compat["components/Link"],flarum.core.compat["helpers/avatar"];const S=flarum.core.compat["helpers/username"];var B=t.n(S),C=function(t){function e(){return t.apply(this,arguments)||this}return h(e,t),e.prototype.view=function(){var t=this.attrs.userMoneyHistory,e=t.changeTime(),o=t.money(),n=t.sourceDesc(),r=(t.id(),t.user(),t.createUser()),s=(t.balanceMoney(),t.lastMoney(),app.translator.trans("D"===t.type()?"gtdxyz-money-plus.history.forum.record.money-out":"gtdxyz-money-plus.history.forum.record.money-in")),a="D"===t.type()?"color:red":"color:green";return m("div",{className:"transferHistoryContainer"},m("div",{className:"history-item-type"},m("i",{className:"fas fa-coins"}),m("span",{className:"changeType",style:a},s),m("span",{className:"changeTime"},e)),m("div",{className:"history-item-source"},m("span",{className:"moneyHistoryUser"},B()(r)),m("span",{className:"changeSource"},n),m("span",{className:"changeDetail"},app.translator.trans("gtdxyz-money-plus.history.forum.record.money-list-change"),":   ",o)))},e}(U()),D=function(t){function e(){return t.apply(this,arguments)||this}h(e,t);var o=e.prototype;return o.oninit=function(e){t.prototype.oninit.call(this,e),this.loading=!0,this.moreResults=!1,this.userMoneyHistory=[],this.user=this.attrs.params.user,this.loadResults()},o.view=function(){var t=this;if(this.loading&&P().component({size:"large"}),j().session.user)return m("div",{className:"money-history-list"},m("div",{className:"title"},j().translator.trans("gtdxyz-money-plus.history.forum.title")),m("ul",{className:"ul-list"},this.userMoneyHistory.map((function(t){return m("li",{key:t.id,"data-id":t.id},C.component({userMoneyHistory:t}))}))),!this.loading&&0===this.userMoneyHistory.length&&m("div",null,m("div",{className:"empty-list"},j().translator.trans("gtdxyz-money-plus.history.forum.list-empty"))),this.hasMoreResults()&&m("div",{className:"load-more"},m(p(),{className:"Button Button--primary",disabled:this.loading,loading:this.loading,onclick:function(){return t.loadMore()}},j().translator.trans("gtdxyz-money-plus.history.forum.money-list-load-more"))))},o.loadMore=function(){this.loading=!0,this.loadResults(this.userMoneyHistory.length)},o.parseResults=function(t){return this.moreResults=!!t.payload.links&&!!t.payload.links.next,[].push.apply(this.userMoneyHistory,t),this.loading=!1,m.redraw(),t},o.hasMoreResults=function(){return this.moreResults},o.loadResults=function(t){void 0===t&&(t=0);var e="/users/"+this.user.id()+"/money/history";return j().store.find(e,{filter:{user:this.user.id()},page:{offset:t}}).catch((function(){})).then(this.parseResults.bind(this))},e}(U()),T=function(t){function e(){return t.apply(this,arguments)||this}h(e,t);var o=e.prototype;return o.oninit=function(e){t.prototype.oninit.call(this,e),this.loadUser(m.route.param("username"))},o.content=function(){return m("div",{className:"Post-body"},D.component({params:{user:this.user}}))},e}(a());const F=flarum.core.compat["common/Model"];var E=t.n(F),I=function(t){function e(){return t.apply(this,arguments)||this}return h(e,t),e}(E());Object.assign(I.prototype,{type:E().attribute("type"),money:E().attribute("money"),sourceDesc:E().attribute("source_desc"),changeTime:E().attribute("change_time"),balanceMoney:E().attribute("balance_money"),lastMoney:E().attribute("last_money"),user:E().hasOne("user"),createUser:E().hasOne("createUser")}),n().initializers.add("gtdxyz-money-plus",(function(){_().prototype.canEditMoney=N().attribute("canEditMoney"),n().store.models.userMoneyHistory=I,n().routes.userMoneyHistory={path:"/u/:username/money/history",component:T},(0,r.extend)(u().prototype,"infoItems",(function(t){var e=n().forum.attribute("gtdxyz-money-plus.moneyname")||"MO",o=this.attrs.user.data.attributes.money;1==n().forum.attribute("gtdxyz-money-plus.noshowzero")?0!==this.attrs.user.data.attributes.money&&t.add("money",m("span",null,o," ",e)):t.add("money",m("span",null,o," ",e))})),(0,r.extend)(c(),"moderationControls",(function(t,e){e.canEditMoney()&&t.add("money",p().component({icon:"fas fa-money-bill",onclick:function(){return n().modal.show(M,{user:e})}},n().translator.trans("gtdxyz-money-plus.forum.user_controls.money_button")+n().forum.attribute("gtdxyz-money-plus.moneyname")))})),(0,r.extend)(a().prototype,"navItems",(function(t){n().session.user&&t.add("userMoneyHistory",O().component({href:n().route("userMoneyHistory",{username:n().session.user.username()}),icon:"fas fa-wallet"},n().forum.attribute("gtdxyz-money-plus.moneyname")+n().translator.trans("gtdxyz-money-plus.history.forum.nav")),10)}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map